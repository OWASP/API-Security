API8:2023 缺乏对自动化威胁的保护
===================================================

| 威胁代理/攻击特征                                            | 安全漏洞                                                     | 影响                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| API相关: 可利用性**3**                                       | 普及率**3**: 可检测性**1**                                   | 技术**1**: 特定于业务                                        |
| 攻击通常涉及理解API的业务模型，找到敏感的业务流程，自动访问这些流程，对业务造成伤害。 | 分解后的攻击，每个请求都代表完全合法的请求，无法被识别为攻击。只有在考虑服务/应用程序业务逻辑时，才能识别攻击。 | 一般不会出现技术方面的影响。攻击可能会以不同的方式损害业务，例如：1. 防止合法用户购买产品；2. 导致游戏内部经济通货膨胀；3. 允许攻击者发送过多的消息/评论，轻松传播假新闻。 |

## API是否易受攻击？

自动化威胁变得越来越具有盈利性、智能化和难以保护，而API经常成为它们的容易目标。传统的防护措施，例如速率限制和验证码，随着时间的推移变得越来越不起作用。例如，运营bot-net的攻击者（用于抢购）可以绕过速率限制，因为他们可以轻松地从世界各地数千个位置/IP地址访问API，只需几秒钟的时间。

易受攻击的API不一定具有实现缺陷。它们只是暴露出一个业务流程-例如购买票证或发布评论-而没有考虑到如果以自动化的方式过度使用该功能会如何损害业务。

每个行业在面对自动化威胁时都可能具有自己特定的风险。

如果API端点暴露出业务敏感的功能，并允许攻击者以过度自动化的方式访问该功能，从而损害业务，则该API端点易受攻击。

[OWASP自动化Web应用程序威胁][1]涵盖了不同类型的自动化威胁及其影响。

## 攻击场景举例

### 场景一

一家科技公司宣布他们将在感恩节发布一款新的游戏机。这款产品需求量很大，库存有限。 攻击者是一个自动化威胁网络的操作员，编写了代码自动购买新产品并完成交易。

在发布当天，攻击者在不同的IP地址和位置上运行代码。API没有实施适当的保护， 允许攻击者在其他合法用户之前购买大部分库存。

攻击者随后在另一个平台上以更高的价格销售产品。

### 场景二

一款打车应用程序提供了推荐计划——用户可以邀请他们的朋友，并为每个加入该应用的朋友获得信用。这个信用可以后来用作现金来预订出租车。

攻击者通过编写脚本来自动化注册流程，每个新用户都会将信用添加到攻击者的钱包中来利用这一流程。

攻击者可以后来享受免费的乘车或出售带有过度信用的帐户换取现金。

## 如何预防

应该分两个层面来进行缓解计划：

    - 业务 - 确定可能会损害业务的业务流程，如果这些流程过度使用会造成危害。
    - 工程 - 选择适当的保护机制来减轻业务风险。

一些保护机制更简单，而另一些则更难以实现。以下方法用于减缓自动化威胁：

- 设备指纹识别：拒绝未预期的客户端设备服务（例如无头浏览器）往往会使威胁参与者使用更复杂的解决方案，因此成本更高
- 真人检测：使用验证码或更高级的生物识别解决方案（例如输入模式）
- 非人类模式：分析用户流以检测非人类模式（例如用户在不到一秒钟的时间内访问“添加到购物车”和“完成购买”功能）
- 考虑阻止Tor出口节点和知名代理的IP地址
- 保护和限制直接被机器使用的API（例如开发人员和B2B API）的访问。它们往往是攻击者的易目标，因为它们经常没有实施所有所需的保护机制。

## 参考资料

### OWASP

* [OWASP Automated Threats to Web Applications][1]
* [API10:2019 Insufficient Logging & Monitoring][2]

[1]: https://owasp.org/www-project-automated-threats-to-web-applications/
[2]: https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xaa-insufficient-logging-monitoring.md
