API3:2019 Excessive Data Exposure
=================================

| Παράγοντες Απειλής/Φορείς Επίθεσης | Αδυναμία Ασφαλείας | Επιπτώσεις |
| - | - | - |
| Εξαρτώνται από το API : Εκμεταλλευσιμότητα **3** | Επιπολασμός **2** : Ανιχνευσιμότητα **2** | Τεχνικές Επιπτώσεις **2** : Εξαρτώνται από την Επιχείρηση |
| Η εκμετάλλευση (exploitation) της υπερβολικής έκθεσης δεδομένων (Excessive Data Exposure) είναι απλή και συνήθως γίνεται ανιχνεύοντας την κίνηση των δεδομένων για ανάλυση των αποκρίσεων του API, αναζητώντας πιθανή έκθεση σε ευαίσθητα δεδομένα που δεν πρέπει να επιστραφούν στον χρήστη. | Τα API βασίζονται σε προγράμματα-πελάτες για την εκτέλεση του φιλτραρίσματος δεδομένων. Δεδομένου ότι τα API χρησιμοποιούνται ως πηγές δεδομένων, μερικές φορές οι προγραμματιστές προσπαθούν να τα εφαρμόσουν με γενικό τρόπο χωρίς να σκέφτονται την ευαισθησία των εκτεθειμένων δεδομένων. Τα αυτόματα εργαλεία συνήθως δεν μπορούν να εντοπίσουν αυτόν τον τύπο ευπάθειας, επειδή είναι δύσκολο να γίνει διάκριση μεταξύ των νόμιμων δεδομένων που επιστρέφονται από το API και των ευαίσθητων δεδομένων που δεν πρέπει να επιστραφούν χωρίς σε βάθος κατανόηση της εφαρμογής. | Η υπερβολική έκθεση δεδομένων οδηγεί συνήθως σε έκθεση ευαίσθητων δεδομένων. |

## Πότε το API είναι ευάλωτο;

Το API επιστρέφει ευαίσθητα δεδομένα στο πρόγραμμα-πελάτη βάσει σχεδίασης. Αυτά τα δεδομένα συνήθως φιλτράρονται από την πλευρά του προγράμματος-πελάτη πριν παρουσιαστούν στον χρήστη. Ένας εισβολέας μπορεί εύκολα ανιχνεύοντας την κίνηση να δει τα ευαίσθητα δεδομένα.

## Παραδείγματα Σεναρίων Επίθεσης

### Σενάριο #1

Η ομάδα που ασχολείται με το development για κινητά χρησιμοποιεί το τελικό σημείο 
`/api/articles/{articleId}/comments/{commentId}` στην προβολή άρθρων για την εμφάνιση 
των μεταδεδομένων των σχολίων. Ανιχνεύοντας την κίνηση της εφαρμογής για κινητά, ένας εισβολέας 
ανακαλύπτει ότι επιστρέφονται και άλλα ευαίσθητα δεδομένα που σχετίζονται 
με τον συντάκτη του σχολίου. Η υλοποίηση τελικού σημείου χρησιμοποιεί μια γενική μέθοδο toJSON() 
στο μοντέλο χρήστη, η οποία περιέχει PII, για τη σειριοποίηση (serialization) του αντικειμένου.

### Σενάριο #2

Ένα σύστημα επιτήρησης που βασίζεται στο IOT επιτρέπει στους διαχειριστές να δημιουργούν χρήστες με διαφορετικά δικαιώματα. Ένας διαχειριστής δημιούργησε έναν λογαριασμό χρήστη για έναν νέο φύλακα που θα πρέπει να έχει πρόσβαση μόνο σε συγκεκριμένα κτίρια στον ιστότοπο. Μόλις ο φύλακας χρησιμοποιήσει την εφαρμογή του για κινητά, ενεργοποιείται μια κλήση API στη διεύθυνση: `/api/sites/111/cameras` προκειμένου να λάβει δεδομένα σχετικά με τις διαθέσιμες κάμερες και να τις εμφανίσει στον πίνακα ελέγχου. Η απάντηση περιέχει μια λίστα με λεπτομέρειες σχετικά με τις κάμερες στην ακόλουθη μορφή: `{"id":"xxx","live_access_token":"xxxx-bbbbb","building_id":"yyy"}`. Ενώ το GUI του πελάτη εμφανίζει μόνο κάμερες στις οποίες θα πρέπει να έχει πρόσβαση ο φύλακας, η πραγματική απόκριση API περιέχει μια πλήρη λίστα με όλες τις κάμερες στον ιστότοπο.

## Τρόπος Πρόληψης

* Μην βασίζεστε ποτέ στην πλευρά του προγράμματος-πελάτη για να φιλτράρετε ευαίσθητα δεδομένα.
* Ελέγξτε τις απαντήσεις από το API για να βεβαιωθείτε ότι περιέχουν μόνο αποδεκτά δεδομένα.
* Οι back-end προγραμματιστές θα πρέπει πάντα να αναρωτιούνται "ποιος είναι ο καταναλωτής των δεδομένων;" 
πριν εκθέσουν δημόσια ένα νέο τελικό σημείο API.
* Αποφύγετε τη χρήση γενικών μεθόδων όπως `to_json()` και `to_string()`. 
Αντίθετα, επιλέξτε συγκεκριμένα πεδία που θέλετε πραγματικά να επιστρέψετε.
* Ταξινομήστε όλες τις ευαίσθητες και προσωπικά αναγνωρίσιμες πληροφορίες (PII) 
τις οποίες αποθηκεύει και συνεργάζεται η εφαρμογή σας, ελέγχοντας όλες τις κλήσεις 
API που επιστρέφουν τέτοιες πληροφορίες για να δείτε εάν αυτές οι απαντήσεις 
δημιουργούν πρόβλημα ασφαλείας.
* Εφαρμόστε έναν μηχανισμό επικύρωσης απόκρισης που βασίζεται σε σχήματα (schema-based)
ως ένα επιπλέον επίπεδο ασφαλείας. Ως μέρος αυτού του μηχανισμού ορίστε και επιβάλλετε 
δεδομένα που επιστρέφονται από όλες τις μεθόδους API, συμπεριλαμβανομένων των σφαλμάτων.


## Αναφορές

### Εξωτερικές

* [CWE-213: Intentional Information Exposure][1]

[1]: https://cwe.mitre.org/data/definitions/213.html
