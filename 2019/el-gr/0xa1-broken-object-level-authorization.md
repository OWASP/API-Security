API1:2019 Broken Object Level Authorization
===========================================

| Παράγοντες Απειλής/Φορείς Επίθεσης | Αδυναμία Ασφαλείας | Επιπτώσεις |
| - | - | - |
| Εξαρτώνται από το API : Εκμεταλλευσιμότητα **3** | Επιπολασμός **3** : Ανιχνευσιμότητα **2** | Τεχνικές **3** : Εξαρτώνται από την Επιχείρηση |
| Οι εισβολείς μπορούν να εκμεταλλευτούν τα τελικά σημεία API που είναι ευάλωτα σε εξουσιοδότηση επιπέδου κατεστραμμένου αντικειμένου (Broken Object Level Authorization), χειραγωγώντας το αναγνωριστικό ενός αντικειμένου που αποστέλλεται εντός του αιτήματος. Αυτό μπορεί να οδηγήσει σε μη εξουσιοδοτημένη πρόσβαση σε ευαίσθητα δεδομένα. Αυτό το ζήτημα είναι εξαιρετικά κοινό σε εφαρμογές που βασίζονται σε API, επειδή το στοιχείο διακομιστή συνήθως δεν παρακολουθεί πλήρως την κατάσταση του προγράμματος-πελάτη και, αντ' αυτού, βασίζεται περισσότερο σε παραμέτρους όπως τα αναγνωριστικά αντικειμένων, που αποστέλλονται από τον πελάτη για να αποφασίσει σε ποια αντικείμενα θα έχει πρόσβαση. | Αυτή είναι η πιο κοινή και επιδραστική επίθεση σε API. Οι μηχανισμοί εξουσιοδότησης και ελέγχου πρόσβασης στις σύγχρονες εφαρμογές είναι περίπλοκοι και ευρέως διαδεδομένοι. Ακόμα κι αν η εφαρμογή εφαρμόζει μια κατάλληλη υποδομή για ελέγχους εξουσιοδότησης, οι προγραμματιστές μπορεί να ξεχάσουν να χρησιμοποιήσουν αυτούς τους ελέγχους πριν αποκτήσουν πρόσβαση σε ένα ευαίσθητο αντικείμενο. Η ανίχνευση ελέγχου πρόσβασης συνήθως δεν υπόκειται σε αυτοματοποιημένες στατικές ή δυναμικές δοκιμές. | Η μη εξουσιοδοτημένη πρόσβαση μπορεί να οδηγήσει σε αποκάλυψη δεδομένων σε μη εξουσιοδοτημένα μέρη, απώλεια δεδομένων ή χειραγώγηση δεδομένων. Η μη εξουσιοδοτημένη πρόσβαση σε αντικείμενα μπορεί επίσης να οδηγήσει σε πλήρη ανάληψη λογαριασμού. (account takeover) |

## Είναι το API ευάλωτο;

Η εξουσιοδότηση επιπέδου αντικειμένου είναι ένας μηχανισμός ελέγχου πρόσβασης 
που συνήθως υλοποιείται σε επίπεδο κώδικα για να επιβεβαιώσει ότι ένας χρήστης 
μπορεί να έχει πρόσβαση μόνο σε αντικείμενα στα οποία θα έπρεπε να έχει πρόσβαση.

Κάθε τελικό σημείο API που λαμβάνει ένα αναγνωριστικό ενός αντικειμένου και εκτελεί 
οποιονδήποτε τύπο ενέργειας στο αντικείμενο, θα πρέπει να εφαρμόζει ελέγχους εξουσιοδότησης 
σε επίπεδο αντικειμένου. Οι έλεγχοι θα πρέπει να επικυρώνουν ότι ο συνδεδεμένος χρήστης 
έχει πρόσβαση για να εκτελέσει την απαιτούμενη ενέργεια στο ζητούμενο αντικείμενο.

Οι αποτυχίες σε αυτόν τον μηχανισμό συνήθως οδηγούν σε μη εξουσιοδοτημένη αποκάλυψη 
πληροφοριών, τροποποίηση ή καταστροφή όλων των δεδομένων.

## Παραδείγματα Σεναρίων Επίθεσης

### Σενάριο #1

Μια πλατφόρμα ηλεκτρονικού εμπορίου για ηλεκτρονικά καταστήματα παρέχει μια σελίδα 
καταχώρισης με τα διαγράμματα εσόδων για τα καταστήματα που φιλοξενούν. Επιθεωρώντας 
τα αιτήματα του προγράμματος περιήγησης, ένας εισβολέας μπορεί να αναγνωρίσει τα 
τελικά σημεία API που χρησιμοποιούνται ως πηγή δεδομένων για αυτά τα γραφήματα 
και το μοτίβο τους `/shops/{shopName}/revenue_data.json`. Χρησιμοποιώντας ένα άλλο 
τελικό σημείο API, ο εισβολέας μπορεί να λάβει τη λίστα με όλα τα ονόματα καταστημάτων 
που φιλοξενούνται. Με ένα απλό σενάριο χειρισμού των ονομάτων στη λίστα, αντικαθιστώντας 
το `{shopName}` στη διεύθυνση URL, ο εισβολέας αποκτά πρόσβαση στα δεδομένα πωλήσεων 
χιλιάδων καταστημάτων ηλεκτρονικού εμπορίου.

### Σενάριο #2

Κατά την παρακολούθηση της κυκλοφορίας δικτύου μιας φορητής συσκευής, το ακόλουθο 
αίτημα HTTP `PATCH` τραβά την προσοχή ενός εισβολέα λόγω της παρουσίας μιας 
προσαρμοσμένης κεφαλίδας αιτήματος HTTP `X-User-Id: 54796`. Αντικαθιστώντας την 
τιμή `X-User-Id` με `54795`, ο εισβολέας λαμβάνει μια επιτυχημένη απάντηση HTTP 
και μπορεί να τροποποιήσει τα δεδομένα λογαριασμού άλλων χρηστών.

## Τρόπος Πρόληψης

* Εφαρμόστε έναν κατάλληλο μηχανισμό εξουσιοδότησης που βασίζεται στις πολιτικές (user policies)
και την ιεραρχία των χρηστών.
* Χρησιμοποιήστε έναν μηχανισμό εξουσιοδότησης για να ελέγξετε εάν ο συνδεδεμένος 
χρήστης έχει πρόσβαση για να εκτελέσει την απαιτούμενη ενέργεια στην εγγραφή σε 
κάθε λειτουργία που χρησιμοποιεί μια είσοδο από τον πελάτη για πρόσβαση σε μια 
εγγραφή στη βάση δεδομένων.
* Προτιμήστε να χρησιμοποιείτε τυχαίες και απρόβλεπτες τιμές ως GUID για τα 
αναγνωριστικά των εγγραφών.
* Γράψτε tests για την αξιολόγηση του μηχανισμού εξουσιοδότησης. Μην αναπτύσσετε 
ευάλωτες αλλαγές που σπάνε τις δοκιμές.

## Αναφορές

### Εξωτερικές

* [CWE-284: Improper Access Control][1]
* [CWE-285: Improper Authorization][2]
* [CWE-639: Authorization Bypass Through User-Controlled Key][3]

[1]: https://cwe.mitre.org/data/definitions/284.html
[2]: https://cwe.mitre.org/data/definitions/285.html
[3]: https://cwe.mitre.org/data/definitions/639.html
